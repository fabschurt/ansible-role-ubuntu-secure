---
- name: Upload GRUB config file
  tags: [config]
  copy:
    src: etc/default/grub
    dest: /etc/default/grub
    mode: 0644
  notify:
    - Update GRUB

- name: Upload miscellaneous config files
  tags: [config]
  copy:
    src: '{{ item }}'
    dest: '/{{ item }}'
    mode: "{{ (item == 'etc/sudoers')|ternary('0440', '0644') }}"
  with_items:
    - etc/apt/apt.conf.d/
    - etc/sudoers
    - etc/sysctl.conf
    - etc/modprobe.d/blacklist.conf
    - etc/default/rkhunter
  notify:
    - Reboot server

- name: Upload firewall (iptables) config
  tags: [config]
  template:
    src: etc/network/if-pre-up.d/iptables
    dest: /etc/network/if-pre-up.d/iptables
    mode: 0755
  notify:
    - Reboot server
