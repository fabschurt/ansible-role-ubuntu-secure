---
- name: Upload custom config files
  tags: [config]
  copy:
    src: '{{ item }}'
    dest: '/{{ item }}'
    mode: "{{ (item == 'etc/sudoers')|ternary('0440', '0644') }}"
  with_items:
    - etc/apt/apt.conf.d/
    - etc/sudoers
    - etc/sysctl.conf
    - etc/modprobe.d/blacklist.conf
    - etc/default/grub
    - etc/default/rkhunter

- name: Upload firewall (iptables) config
  tags: [config]
  template:
    src: etc/network/if-pre-up.d/iptables
    dest: /etc/network/if-pre-up.d/iptables
    mode: 0755

- name: Update GRUB config
  tags: [config]
  shell: update-grub2 || update-grub
